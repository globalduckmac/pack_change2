
{% extends "base.html" %}

{% block title %}–ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>–ò—Å—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤</h2>
        
        {% if history %}
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                                <th>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</th>
                                <th>–î–µ—Ç–∞–ª–∏</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in history %}
                            <tr>
                                <td>{{ item.timestamp }}</td>
                                <td>
                                    {% if item.type == 'generation' %}
                                        <span class="badge bg-primary">üì¶ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤</span>
                                    {% elif item.type == 'apk_processing' %}
                                        <span class="badge bg-success">üîß –û–±—Ä–∞–±–æ—Ç–∫–∞ APK</span>
                                    {% else %}
                                        <span class="badge bg-secondary">üì¶ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if item.type == 'generation' %}
                                        –°–æ–∑–¥–∞–Ω–æ {{ item.count }} –ø–∞–∫–µ—Ç–æ–≤
                                        {% if item.examples %}
                                        <details class="mt-1">
                                            <summary>–ü—Ä–∏–º–µ—Ä—ã –ø–∞–∫–µ—Ç–æ–≤</summary>
                                            <small>
                                                {% for pkg in item.examples %}
                                                {{ pkg }}<br>
                                                {% endfor %}
                                            </small>
                                        </details>
                                        {% endif %}
                                    {% elif item.type == 'apk_processing' %}
                                        <strong>APK:</strong> {{ item.apk_name }}<br>
                                        <strong>–°–æ–∑–¥–∞–Ω–æ –ø–∞–∫–µ—Ç–æ–≤:</strong> {{ item.packages_count }}
                                        {% if item.packages_examples %}
                                        <details class="mt-1">
                                            <summary>–ü—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤</summary>
                                            <small>
                                                {% for pkg in item.packages_examples %}
                                                {{ pkg }}<br>
                                                {% endfor %}
                                            </small>
                                        </details>
                                        {% endif %}
                                    {% else %}
                                        {{ item.count }} –ø–∞–∫–µ—Ç–æ–≤
                                    {% endif %}
                                </td>
                                <td>
                                    {% if item.type == 'apk_processing' %}
                                        <a href="{{ url_for('download_packages_by_apk', apk_name=item.apk_name) }}" 
                                           class="btn btn-sm btn-info mb-1">
                                            üì• –°–∫–∞—á–∞—Ç—å APK
                                        </a><br>
                                    {% endif %}
                                    <a href="{{ url_for('delete_package_history', index=loop.index0) }}" 
                                       class="btn btn-sm btn-danger"
                                       onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% else %}
        <div class="alert alert-info">
            <h4>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</h4>
            <p>–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø–∞–∫–µ—Ç—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏.</p>
            <a href="{{ url_for('index') }}" class="btn btn-primary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
